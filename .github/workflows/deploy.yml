name: Deploy to Production Server

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Deploy to server via SSH
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.SSH_HOST }}
          port: ${{ secrets.SSH_PORT }}
          username: ${{ secrets.SSH_USER }}
          password: ${{ secrets.SSH_PASSWORD }}
          script_stop: true
          script: |
            CONTAINER_NAME="importador_xlsx"
            CONTAINER_PATH="/home/discra/importador_xlsx"
            
            echo "ðŸš€ Iniciando deployment..."
            cd "$CONTAINER_PATH"
            
            echo "ðŸ“¥ Pulling latest changes..."
            git fetch origin
            git reset --hard origin/main
            git clean -fd
            
            echo "ðŸ“¦ Installing dependencies..."
            npm ci --production
            
            echo "ðŸ”„ Restarting container..."
            docker restart "$CONTAINER_NAME"
            
            echo "ðŸ“Š Status:"
            docker ps --filter "name=$CONTAINER_NAME" --format "table {{.Names}}\t{{.Status}}"
            
            echo "âœ… Deploy concluÃ­do!"
